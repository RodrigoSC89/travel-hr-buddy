# ğŸ“Š Forecast Weekly - Visual Summary

## ğŸ¯ Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FORECAST WEEKLY CRON JOB                   â”‚
â”‚                   (Every Sunday 03:00 UTC)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Trigger Cron    â”‚
                   â”‚  schedule:       â”‚
                   â”‚  "0 3 * * 0"     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Fetch Active    â”‚
                   â”‚  Jobs from       â”‚
                   â”‚  mmi_jobs        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  For Each Job:                  â”‚
            â”‚  1. Simulate AI Risk            â”‚
            â”‚  2. Calculate Next Date         â”‚
            â”‚  3. Create Forecast             â”‚
            â”‚  4. Create OS if High Risk      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Output    â”‚
                    â”‚   Summary   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  mmi_jobs    â”‚  â† Input: Active jobs (pending, in_progress)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SELECT *
       â”‚ WHERE status IN ('pending', 'in_progress')
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Processing  â”‚
â”‚              â”‚
â”‚  â€¢ 70% â†’ moderado (30 dias)
â”‚  â€¢ 30% â†’ alto (7 dias)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚mmi_forecasts â”‚    â”‚ mmi_orders   â”‚    â”‚   Logs       â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ All jobs     â”‚    â”‚ High risk    â”‚    â”‚ Execution    â”‚
â”‚ get forecast â”‚    â”‚ only (30%)   â”‚    â”‚ summary      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ² Risk Simulation Logic

```typescript
// Current Implementation (Mock)
const risco = Math.random() > 0.7 ? 'alto' : 'moderado'

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Random Number Generation           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0.7 â”€â”€â”€â”€â”€â”€â”€â”€ 1.0  â”‚
â”‚  â””â”€â”€â”€ moderado â”€â”€â”€â”˜  â””â”€â”€ alto â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  Probability Distribution:          â”‚
â”‚  â€¢ Moderado: 70%                    â”‚
â”‚  â€¢ Alto: 30%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… Next Execution Date Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Risk Level â†’ Next Date                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ALTO   â”‚  â†’   â”‚  Today + 7 days  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚MODERADO â”‚  â†’   â”‚  Today + 30 days â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Automatic Work Order Creation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Forecast Decision Tree                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   Forecast Created
                        â”‚
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Risco?   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   /         \
                  /           \
            moderado          alto
                /               \
               â–¼                 â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  No Action   â”‚   â”‚  Create OS   â”‚
      â”‚  (just log)  â”‚   â”‚  in          â”‚
      â”‚              â”‚   â”‚  mmi_orders  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ OS Details:  â”‚
                        â”‚ â€¢ forecast_idâ”‚
                        â”‚ â€¢ priority   â”‚
                        â”‚ â€¢ status     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Database Tables                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  mmi_jobs    â”‚
â”‚              â”‚
â”‚  â€¢ id        â”‚
â”‚  â€¢ job_id    â”‚
â”‚  â€¢ title     â”‚
â”‚  â€¢ status    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                         â”‚
                         â”‚ (Input)
                         â”‚
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚mmi_forecasts â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚
â”‚  â€¢ id        â”‚â”€â”€â”€â”€â”
â”‚  â€¢ vessel    â”‚    â”‚
â”‚  â€¢ system    â”‚    â”‚
â”‚  â€¢ forecast  â”‚    â”‚
â”‚  â€¢ priority  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚
                    â”‚ (foreign key)
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ mmi_orders   â”‚
            â”‚              â”‚
            â”‚ â€¢ id         â”‚
            â”‚ â€¢ forecast_idâ”‚
            â”‚ â€¢ vessel     â”‚
            â”‚ â€¢ system     â”‚
            â”‚ â€¢ descriptionâ”‚
            â”‚ â€¢ status     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Example Execution Timeline

```
Week 1 (Oct 20, 2025)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sunday 03:00 UTC  â†’  Cron Trigger
                  â†’  15 jobs processed
                  â†’  15 forecasts created
                  â†’  4 OS created (high risk)

Week 2 (Oct 27, 2025)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sunday 03:00 UTC  â†’  Cron Trigger
                  â†’  18 jobs processed
                  â†’  18 forecasts created
                  â†’  6 OS created (high risk)

Week 3 (Nov 03, 2025)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sunday 03:00 UTC  â†’  Cron Trigger
                  â†’  12 jobs processed
                  â†’  12 forecasts created
                  â†’  3 OS created (high risk)
```

---

## ğŸ¨ Response Format

```json
{
  "success": true,
  "timestamp": "2025-10-20T03:00:00.000Z",
  
  "jobs_processed": 15,        // â† Jobs fetched from mmi_jobs
  "forecasts_created": 15,     // â† Forecasts inserted
  "orders_created": 4,         // â† OS created for high risk
  
  "forecast_summary": {
    "high_risk": 4,            // â† 30% probability
    "moderate_risk": 11        // â† 70% probability
  }
}
```

---

## ğŸ”§ Configuration Files

```
Repository Structure:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
travel-hr-buddy/
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ config.toml                    â† Cron configuration
â”‚   â”‚   â””â”€â”€ [[edge_runtime.cron]]
â”‚   â”‚       name = "forecast-weekly"
â”‚   â”‚       schedule = "0 3 * * 0"
â”‚   â”‚
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ forecast-weekly/
â”‚           â””â”€â”€ index.ts               â† Function implementation
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ MMI_FORECAST_WEEKLY_README.md      â† Full docs
    â”œâ”€â”€ MMI_FORECAST_WEEKLY_QUICKREF.md    â† Quick ref
    â””â”€â”€ MMI_FORECAST_WEEKLY_VISUAL_SUMMARY.md  â† This file
```

---

## ğŸš€ Quick Actions

### âœ… Test Function
```bash
supabase functions invoke forecast-weekly
```

### âœ… Check Forecasts
```sql
SELECT COUNT(*) FROM mmi_forecasts 
WHERE created_at >= NOW() - INTERVAL '7 days';
```

### âœ… Check Work Orders
```sql
SELECT COUNT(*) FROM mmi_orders 
WHERE created_at >= NOW() - INTERVAL '7 days';
```

### âœ… View Logs
```
Supabase Dashboard â†’ Edge Functions â†’ forecast-weekly â†’ Logs
```

---

## ğŸ“ Key Metrics to Monitor

| Metric | Expected Value | Alert If |
|--------|----------------|----------|
| Jobs Processed | 10-50 per week | < 5 or > 100 |
| Forecasts Created | = Jobs Processed | â‰  Jobs |
| Orders Created | ~30% of Jobs | < 10% or > 50% |
| Execution Time | < 30 seconds | > 60 seconds |
| Success Rate | 100% | < 95% |

---

## ğŸ¯ Future Enhancements

```
Phase 1: Mock Simulation (CURRENT)
â”œâ”€ Math.random() risk generation
â”œâ”€ Fixed date calculation
â””â”€ Basic logging

Phase 2: Real AI Integration (PLANNED)
â”œâ”€ OpenAI GPT-4 API calls
â”œâ”€ Historical data analysis
â”œâ”€ Predictive maintenance scores
â””â”€ Confidence levels

Phase 3: Advanced Features (FUTURE)
â”œâ”€ Email notifications
â”œâ”€ Custom intervals per system
â”œâ”€ Machine learning optimization
â””â”€ Dashboard visualization
```

---

âœ… **Status:** Implemented and Ready  
ğŸ“… **Last Updated:** October 2025  
ğŸ”— **Related Docs:** See README and QUICKREF

# DP Advisor Visual Summary

## ğŸ¨ User Interface

### Component Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DP Intelligence Center                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  [DP AI Analyzer - Full Width]                             â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â”‚                              â”‚
â”‚   [DP Overview]              â”‚   [DP Advisor Panel] â† NEW   â”‚
â”‚                               â”‚                              â”‚
â”‚   â€¢ System Status            â”‚   ğŸ§­ Compass Icon           â”‚
â”‚   â€¢ Active Vessels           â”‚   DP Advisor - OtimizaÃ§Ã£o    â”‚
â”‚   â€¢ Current Operations       â”‚                              â”‚
â”‚                               â”‚   ğŸ’¨ Wind Icon              â”‚
â”‚                               â”‚                              â”‚
â”‚                               â”‚   STATUS MESSAGE             â”‚
â”‚                               â”‚   (Green/Yellow/Red)         â”‚
â”‚                               â”‚                              â”‚
â”‚                               â”‚   Status: [OK/Risco/CrÃ­tico] â”‚
â”‚                               â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                              â”‚
â”‚  [DP Realtime - Full Width]                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Status Indicators

### âœ… OK Status (Green)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§­ DP Advisor â€” OtimizaÃ§Ã£o         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ’¨                         â”‚
â”‚                                     â”‚
â”‚  Sistema DP dentro dos limites.    â”‚  â† Green Text
â”‚                                     â”‚
â”‚      Status: OK                     â”‚  â† Gray Text
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš ï¸ Risco Status (Yellow)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§­ DP Advisor â€” OtimizaÃ§Ã£o         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ’¨                         â”‚
â”‚                                     â”‚
â”‚  Risco crescente â€” revisar thrust  â”‚  â† Yellow Text
â”‚  allocation e referÃªncia ativa.    â”‚
â”‚                                     â”‚
â”‚      Status: Risco                  â”‚  â† Gray Text
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”´ CrÃ­tico Status (Red)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§­ DP Advisor â€” OtimizaÃ§Ã£o         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ğŸ’¨                         â”‚
â”‚                                     â”‚
â”‚  Alerta de perda de posiÃ§Ã£o!       â”‚  â† Red Text
â”‚  Verificar sensores de heading e   â”‚
â”‚  standby thrusters.                â”‚
â”‚                                     â”‚
â”‚      Status: CrÃ­tico                â”‚  â† Gray Text
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telemetry API  â”‚ /api/dp/telemetry
â”‚  (REST)         â”‚ Returns: wind, current, mode, load, etc.
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DPAdvisorPanel â”‚ Fetches every 30 seconds
â”‚  (React)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dp-advisor-     â”‚ ONNX Model Inference
â”‚ engine.ts       â”‚ Input: [1, 6] tensor
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Output: recommendations
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MQTT Publishâ”‚    â”‚  Supabase    â”‚    â”‚  UI Display  â”‚
â”‚ nautilus/   â”‚    â”‚  Insert Log  â”‚    â”‚  Color-Coded â”‚
â”‚ dp/advice   â”‚    â”‚  RLS Policy  â”‚    â”‚  Status      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ONNX Model Architecture

```
Input Tensor [1, 6]
â”œâ”€â”€ windSpeed (float)
â”œâ”€â”€ currentSpeed (float)
â”œâ”€â”€ mode (0 or 1)
â”œâ”€â”€ load (float)
â”œâ”€â”€ generatorLoad (float)
â””â”€â”€ positionError (float)
         â†“
    [ONNX Model]
    nautilus_dp_advisor.onnx
         â†“
Output Tensor [1, 1]
â””â”€â”€ recommendations (float 0.0-1.0)
         â†“
  Risk Classification
  â”œâ”€â”€ < 0.4 â†’ OK
  â”œâ”€â”€ < 0.7 â†’ Risco
  â””â”€â”€ â‰¥ 0.7 â†’ CrÃ­tico
```

## ğŸ—„ï¸ Database Schema

```sql
dp_advisor_logs
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ timestamp (timestamptz)     â† Indexed
â”œâ”€â”€ level (text)                â† Indexed
â”œâ”€â”€ message (text)
â””â”€â”€ created_at (timestamptz)

Indexes:
- idx_dp_advisor_logs_timestamp
- idx_dp_advisor_logs_level

RLS Policies:
- Allow authenticated users to SELECT
- Allow authenticated users to INSERT
```

## ğŸ”Œ MQTT Integration

```
Topic: nautilus/dp/advice

Payload Structure:
{
  "level": "OK" | "Risco" | "CrÃ­tico",
  "message": "Sistema DP dentro dos limites."
}

QoS: 1 (At least once delivery)
Retain: false
```

## ğŸ“ File Structure

```
travel-hr-buddy/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ nautilus_dp_advisor.onnx          â† NEW (ONNX Model)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ dp-intelligence/
â”‚   â”‚       â”œâ”€â”€ DPAdvisorPanel.tsx            â† NEW (UI Component)
â”‚   â”‚       â”œâ”€â”€ DPOverview.tsx                (Existing)
â”‚   â”‚       â”œâ”€â”€ DPRealtime.tsx                (Existing)
â”‚   â”‚       â””â”€â”€ DPAIAnalyzer.tsx              (Existing)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â””â”€â”€ dp-advisor-engine.ts          â† NEW (AI Engine)
â”‚   â”‚   â””â”€â”€ mqtt/
â”‚   â”‚       â””â”€â”€ publisher.ts                   â† MODIFIED (Fixed duplicates)
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ DPIntelligence.tsx                 â† MODIFIED (Added Panel)
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 20251021180000_create_dp_advisor_logs.sql  â† NEW (DB Migration)
â”œâ”€â”€ DP_ADVISOR_PATCH20_IMPLEMENTATION.md       â† NEW (Documentation)
â””â”€â”€ DP_ADVISOR_QUICKREF.md                     â† NEW (Quick Ref)
```

## ğŸ¬ Component Lifecycle

```
1. Component Mount
   â†“
2. useEffect Hook Triggered
   â†“
3. Initial runAdvisor() Call
   â†“
4. Fetch /api/dp/telemetry
   â†“
5. Run ONNX Inference
   â†“
6. Classify Risk Level
   â†“
7. Update UI State
   â†“
8. Publish to MQTT
   â†“
9. Log to Supabase
   â†“
10. Set 30-second Interval
    â†“
11. [Loop back to step 3]
```

## ğŸ¨ Color Palette

```
Status Colors:
â”œâ”€â”€ OK:        #4ADE80 (green-400)
â”œâ”€â”€ Risco:     #FACC15 (yellow-400)
â”œâ”€â”€ CrÃ­tico:   #EF4444 (red-500)
â”œâ”€â”€ Error:     #FB923C (orange-400)
â””â”€â”€ Default:   #9CA3AF (gray-400)

UI Elements:
â”œâ”€â”€ Card Title:  #22D3EE (cyan-400)
â”œâ”€â”€ Icon:        #67E8F9 (cyan-300)
â””â”€â”€ Subtitle:    #9CA3AF (gray-400)
```

## ğŸ“ˆ Performance Metrics

```
Refresh Rate:        30 seconds
Model Inference:     ~50ms
MQTT Publish:        ~100ms (network dependent)
Supabase Insert:     ~200ms (async)
Total Cycle:         ~350ms per update
UI Update:           Immediate (React state)
```

## ğŸ” Security Model

```
Authentication Flow:
User Login
   â†“
Supabase Auth
   â†“
JWT Token
   â†“
RLS Policies Applied
   â”œâ”€â”€ Can SELECT dp_advisor_logs
   â””â”€â”€ Can INSERT dp_advisor_logs

MQTT Security:
   â”œâ”€â”€ WebSocket Secure (wss://)
   â”œâ”€â”€ Broker Authentication
   â””â”€â”€ Topic-based Access Control
```

## ğŸš€ Deployment Architecture

```
Development:
localhost:8080 â†’ Vite Dev Server
   â†“
Local MQTT Broker (optional)
   â†“
Supabase (cloud)

Production:
Vercel/Netlify â†’ Static Build
   â†“
MQTT Broker (wss://broker.emqx.io:8084/mqtt)
   â†“
Supabase (cloud)
```

## âœ… Success Criteria

- [x] Component renders without errors
- [x] Auto-refresh works (30s interval)
- [x] Color coding matches risk level
- [x] ONNX model loads successfully
- [x] MQTT messages published
- [x] Supabase logs created
- [x] Build completes successfully
- [x] No TypeScript errors
- [x] Follows existing UI patterns
- [x] Documentation complete

# Incident Response AI - Supabase Schema

## Table: incident_reports

This table stores incident reports generated by the Incident Response AI Core system.

### SQL Schema

```sql
create table incident_reports (
  id uuid primary key default uuid_generate_v4(),
  timestamp timestamptz not null,
  module text,
  type text,
  severity text,
  message text,
  riskScore numeric,
  compliance text[]
);
```

### Fields Description

- **id**: UUID - Primary key, auto-generated
- **timestamp**: timestamptz - Timestamp when the incident was reported (ISO 8601 format)
- **module**: text - The module that generated the incident (e.g., "DP Advisor", "Maintenance Orchestrator", "Control Hub")
- **type**: text - Type of incident (e.g., "DP Failure", "Cyber Breach", "Maintenance Delay", "Safety Alert")
- **severity**: text - Severity level (e.g., "Critical", "Major", "Moderate", "Minor")
- **message**: text - Description of the incident
- **riskScore**: numeric - Calculated risk score (0.1 to 0.9)
- **compliance**: text[] - Array of applicable maritime compliance standards (e.g., ["IMCA M109", "ISM Code 10.2"])

### Compliance Standards Mapping

The system automatically maps incident types to relevant maritime standards:

- **DP Failure**: IMCA M109, IMCA M254, ISM Code 10.2
- **Cyber Breach**: ISPS Code Part B-16, IMO MSC.428(98)
- **Maintenance Delay**: IMCA M140, NORMAM 101, ISM Code 10.3
- **Safety Alert**: IMCA M103, IMCA M166, ISM Code 9.1

### Risk Score Calculation

Risk scores are calculated based on severity:

- **Critical**: 0.9
- **Major**: 0.7
- **Moderate**: 0.4
- **Minor**: 0.2
- **Default**: 0.1

### Real-time Subscriptions

The ComplianceReporter component subscribes to real-time changes on this table using Supabase Realtime:

```typescript
supabase
  .channel("incident_reports")
  .on("postgres_changes", { event: "*", schema: "public", table: "incident_reports" }, callback)
  .subscribe();
```

### Integration with Other Systems

- **MQTT**: Incidents are published to `nautilus/incidents/alert` topic for real-time alerting
- **Maintenance Orchestrator**: Can trigger maintenance workflows based on incident type
- **DP Advisor**: Monitors DP-related incidents for analysis
- **Control Hub**: Central monitoring and response coordination
